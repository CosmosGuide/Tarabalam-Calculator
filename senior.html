<style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f6; padding: 20px; }
    .card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
    h2 { color: #2c3e50; text-align: center; font-size: 24px; }
    select { width: 100%; padding: 15px; font-size: 18px; border-radius: 8px; border: 2px solid #ddd; margin: 10px 0; }
    .btn { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 20px; cursor: pointer; font-weight: bold; }
    .status-badge { text-align: center; padding: 10px; margin-bottom: 20px; border-radius: 5px; font-weight: bold; font-size: 14px; }
    .live { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
    .result-box { margin-top: 20px; padding: 20px; border-radius: 12px; display: none; text-align: center; }
    .good { background: #d4edda; border: 2px solid #c3e6cb; color: #155724; }
    .bad { background: #f8d7da; border: 2px solid #f5c6cb; color: #721c24; }
    .neutral { background: #fff3cd; border: 2px solid #ffeeba; color: #856404; }
    .star-info { font-size: 18px; margin-bottom: 5px; font-weight: bold; }
</style>

<div class="card">
    <h2>üåü Today's Tarabalam</h2>
    
    <div id="statusBanner" class="status-badge live">
        üõ∞Ô∏è <span id="statusText">Syncing with Bangalore Sky...</span>
    </div>

    <div style="text-align: center; margin-bottom: 20px;">
        <div class="star-info">Today's Star: <span id="todayStarDisplay" style="color:#d35400;">Loading...</span></div>
        <small id="dateDisplay" style="color: #7f8c8d;"></small>
    </div>

    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Select Your Birth Star:</label>
    <select id="userStar"></select>

    <button class="btn" onclick="calculateTarabalam()">Check My Luck Today</button>

    <div id="result" class="result-box">
        <div id="resultIcon" style="font-size: 50px; margin-bottom: 10px;"></div>
        <h3 id="taraName" style="margin: 0; font-size: 26px;"></h3>
        <p id="taraDesc" style="font-size: 18px; line-height: 1.4;"></p>
    </div>
</div>

<script>
    const nakshatras = ["Ashwini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra", "Punarvasu", "Pushya", "Ashlesha", "Magha", "Purva Phalguni", "Uttara Phalguni", "Hasta", "Chitra", "Swati", "Vishakha", "Anuradha", "Jyeshtha", "Mula", "Purva Ashadha", "Uttara Ashadha", "Shravana", "Dhanishta", "Shatabhisha", "Purva Bhadrapada", "Uttara Bhadrapada", "Revati"];

    const taraData = {
        1: { name: "Janma Tara", type: "neutral", icon: "‚ö†Ô∏è", desc: "Body/Health focus. Stay calm, avoid heavy strain, and keep things routine." },
        2: { name: "Sampat Tara", type: "good", icon: "üí∞", desc: "Wealth & Success. Very lucky for money matters and starting good work!" },
        3: { name: "Vipat Tara", type: "bad", icon: "‚õî", desc: "Obstacles. Be careful with travel or arguments today. Postpone big decisions." },
        4: { name: "Kshema Tara", type: "good", icon: "üõ°Ô∏è", desc: "Safe & Secure. A protected day. Good for family time and health." },
        5: { name: "Pratyari Tara", type: "bad", icon: "üöß", desc: "Opposition. Others might disagree with you. Stay patient and avoid conflict." },
        6: { name: "Sadhana Tara", type: "good", icon: "üéØ", desc: "Achievement. Your hard work will pay off today. Great for getting things done!" },
        7: { name: "Naidhana Tara", type: "bad", icon: "‚ö†Ô∏è", desc: "Highly Cautionary. Avoid any major new activity. Rest and stay safe." },
        8: { name: "Mitra Tara", type: "good", icon: "üë•", desc: "Friendly Day. Good for meeting friends and happy conversations." },
        0: { name: "Ati-Mitra Tara", type: "good", icon: "‚≠ê", desc: "Best Friend. Highly auspicious! Everything moves in your favor today." }
    };

    let todayIndex = null;

    // Load dropdown
    const select = document.getElementById('userStar');
    nakshatras.forEach((n, i) => select.options.add(new Option(n, i + 1)));

    async function initPanchang() {
        try {
            const now = new Date();
            // Get current Bangalore Time (IST)
            const dateStr = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}`;
            const timeStr = `${now.getHours()}:${now.getMinutes()}`;
            
            // API Call: Using current exact time to catch the transition
            const url = `https://api.vedastro.org/api/PanchangInfo/GetPanchangData?Date=${dateStr}&Time=${timeStr}&Latitude=12.9716&Longitude=77.5946&TimeZoneOffset=+05:30&Ayanamsha=Lahiri`;
            
            const res = await fetch(url);
            const data = await res.json();
            
            const apiStar = data.MoonNakshatra;
            todayIndex = nakshatras.findIndex(n => apiStar.toLowerCase().includes(n.toLowerCase()));
            
            document.getElementById('todayStarDisplay').innerText = nakshatras[todayIndex];
            document.getElementById('statusText').innerText = "‚úì Sky Data Updated (Bangalore)";
            document.getElementById('dateDisplay').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + " | IST";
        } catch (e) {
            // Error Fallback: Manual logic for Feb 20, 2026 if API fails
            const hours = new Date().getHours();
            const mins = new Date().getMinutes();
            const total = (hours * 60) + mins;
            
            // 20:46 (8:46 PM) transition
            todayIndex = (total < 1246) ? 25 : 26; 
            document.getElementById('todayStarDisplay').innerText = nakshatras[todayIndex];
            document.getElementById('statusText').innerText = "‚ö†Ô∏è Using Offline Local Time";
        }
    }

    function calculateTarabalam() {
        if(todayIndex === null) return;
        const birthStar = parseInt(select.value);
        const currentStar = todayIndex + 1;
        
        let diff = (currentStar - birthStar + 1);
        if (diff <= 0) diff += 27;
        const score = diff % 9;
        
        const tara = taraData[score];
        const resDiv = document.getElementById('result');
        resDiv.style.display = 'block';
        resDiv.className = `result-box ${tara.type}`;
        document.getElementById('resultIcon').innerText = tara.icon;
        document.getElementById('taraName').innerText = tara.name;
        document.getElementById('taraDesc').innerText = tara.desc;
        
        resDiv.scrollIntoView({ behavior: 'smooth' });
    }

    window.onload = initPanchang;
</script>
