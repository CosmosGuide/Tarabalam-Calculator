<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CosmosGuide | Live Tarabalam</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Branding */
        .brand-container { text-align: center; margin-bottom: 20px; color: white; }
        .logo { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 10px; border: 2px solid gold; }
        .brand-name { font-size: 26px; font-weight: bold; margin: 0; letter-spacing: 1px; }

        /* Card */
        .card {
            background: white;
            width: 100%;
            max-width: 450px;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            box-sizing: border-box;
        }

        .status-banner {
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .live { background: #e8f5e9; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        .loading { background: #fff3e0; color: #ef6c00; }

        label { font-weight: bold; font-size: 13px; color: #555; text-transform: uppercase; display: block; margin-bottom: 5px; }
        
        select, .display-box {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .display-box {
            background: #f9f9f9;
            color: #d35400;
            font-weight: bold;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        /* Action Buttons */
        .btn-check {
            width: 100%;
            padding: 16px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn-check:disabled { background: #ccc; cursor: not-allowed; }

        .refresh-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            line-height: 1;
        }

        #resultArea {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            display: none;
            text-align: center;
        }
        .good { background: #d4edda; border: 1px solid #c3e6cb; }
        .bad { background: #f8d7da; border: 1px solid #f5c6cb; }
        .neutral { background: #fff3cd; border: 1px solid #ffeeba; }
    </style>
</head>
<body>

    <div class="brand-container">
        <img src="icon-192.png" alt="CosmosGuide" class="logo">
        <h1 class="brand-name">CosmosGuide</h1>
        <div style="font-size: 12px; opacity: 0.8;">LIVE BANGALORE PANCHANG</div>
    </div>

    <div class="card">
        <div id="status" class="status-banner loading">üì° Connecting to Bangalore Sky...</div>

        <label>Your Birth Star</label>
        <select id="userStar"></select>

        <label>Current Star (Live)</label>
        <div class="display-box">
            <span id="starDisplay">Checking...</span>
            <button class="refresh-btn" onclick="fetchLive()" title="Sync Data">üîÑ</button>
        </div>

        <button id="checkBtn" class="btn-check" onclick="calculate()" disabled>Check Alignment</button>

        <div id="resultArea">
            <div id="resIcon" style="font-size: 40px;"></div>
            <h3 id="resName" style="margin: 5px 0;"></h3>
            <p id="resDesc" style="font-size: 14px; margin: 0;"></p>
        </div>
    </div>

<script>
    const nakshatras = ["Ashwini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra", "Punarvasu", "Pushya", "Ashlesha", "Magha", "Purva Phalguni", "Uttara Phalguni", "Hasta", "Chitra", "Swati", "Vishakha", "Anuradha", "Jyeshtha", "Mula", "Purva Ashadha", "Uttara Ashadha", "Shravana", "Dhanishta", "Shatabhisha", "Purva Bhadrapada", "Uttara Bhadrapada", "Revati"];

    const taraData = {
        1: { name: "Janma Tara", type: "neutral", icon: "‚ö†Ô∏è", desc: "Focus on routine. Avoid major physical strain." },
        2: { name: "Sampat Tara", type: "good", icon: "üí∞", desc: "Excellent for money matters and new beginnings." },
        3: { name: "Vipat Tara", type: "bad", icon: "‚õî", desc: "Obstacles possible. Be cautious with travel/risks." },
        4: { name: "Kshema Tara", type: "good", icon: "üõ°Ô∏è", desc: "A safe, protected, and auspicious day." },
        5: { name: "Pratyak Tara", type: "bad", icon: "üöß", desc: "Minor hurdles. Stay patient and avoid conflict." },
        6: { name: "Sadhana Tara", type: "good", icon: "üéØ", desc: "Achievement. Efforts today will bring success." },
        7: { name: "Naidhana Tara", type: "bad", icon: "‚ö†Ô∏è", desc: "High caution. Rest and avoid major new tasks." },
        8: { name: "Mitra Tara", type: "good", icon: "üë•", desc: "A friendly and supportive day for social work." },
        0: { name: "Ati-Mitra Tara", type: "good", icon: "‚≠ê", desc: "Highly auspicious! Success is very likely." }
    };

    let liveIndex = null;
    const select = document.getElementById('userStar');
    nakshatras.forEach((n, i) => select.options.add(new Option(n, i + 1)));

    async function fetchLive() {
        const status = document.getElementById('status');
        const display = document.getElementById('starDisplay');
        const btn = document.getElementById('checkBtn');
        
        status.className = "status-banner loading";
        status.innerText = "üì° Syncing Live Data...";
        btn.disabled = true;

        try {
            const now = new Date();
            const date = `${now.getDate()}/${now.getMonth() + 1}/${now.getFullYear()}`;
            const time = `${now.getHours()}:${now.getMinutes()}`;
            
            // Explicit Bangalore Coordinates
            const url = `https://api.vedastro.org/api/PanchangInfo/GetPanchangData?Date=${date}&Time=${time}&Latitude=12.9716&Longitude=77.5946&TimeZoneOffset=+05:30&Ayanamsha=Lahiri`;
            
            const res = await fetch(url);
            const data = await res.json();
            
            if (data.MoonNakshatra) {
                liveIndex = nakshatras.findIndex(n => data.MoonNakshatra.toLowerCase().includes(n.toLowerCase()));
                display.innerText = nakshatras[liveIndex];
                status.className = "status-banner live";
                status.innerText = "‚óè Live Bangalore Sky Verified";
                btn.disabled = false;
            } else { throw new Error(); }
        } catch (e) {
            status.className = "status-banner error";
            status.innerText = "‚ùå Connection Failed. Check Internet.";
            display.innerText = "Reconnect Required";
        }
    }

    function calculate() {
        const birth = parseInt(select.value);
        let diff = ((liveIndex + 1) - birth + 1);
        if (diff <= 0) diff += 27;
        const tara = taraData[diff % 9];
        
        const area = document.getElementById('resultArea');
        area.style.display = 'block';
        area.className = tara.type;
        document.getElementById('resIcon').innerText = tara.icon;
        document.getElementById('resName').innerText = tara.name;
        document.getElementById('resDesc').innerText = tara.desc;
    }

    window.onload = fetchLive;
</script>
</body>
</html>
