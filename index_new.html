<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CosmosGuide | Precision GPS Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .brand-container { text-align: center; margin-bottom: 20px; color: white; }
        .logo { width: 90px; height: 90px; border-radius: 50%; border: 2px solid gold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .brand-name { font-size: 26px; font-weight: bold; margin: 0; letter-spacing: 1px; }

        .card {
            background: white;
            width: 100%;
            max-width: 450px;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            box-sizing: border-box;
        }

        .location-badge {
            font-size: 11px;
            color: #7f8c8d;
            text-align: right;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
        }

        .progress-container {
            margin: 15px 0 5px 0;
            background: #eee;
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            width: 0%;
            transition: width 1s ease-in-out;
        }
        .progress-label {
            font-size: 11px;
            color: #7f8c8d;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        label { font-weight: bold; font-size: 12px; color: #555; text-transform: uppercase; display: block; margin-bottom: 5px; }
        
        select, .display-box {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #eee;
            border-radius: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .display-box {
            background: #f9f9f9;
            color: #d35400;
            font-weight: bold;
            text-align: center;
        }

        .btn-check {
            width: 100%;
            padding: 16px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        #resultArea {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
            text-align: center;
        }

        .good { background: #d4edda; border: 2px solid #c3e6cb; color: #155724; }
        .bad { background: #f8d7da; border: 2px solid #f5c6cb; color: #721c24; }
        .neutral { background: #fff3cd; border: 2px solid #ffeeba; color: #856404; }
    </style>
</head>
<body>

    <div class="brand-container">
        <img src="icon-192.png" alt="CosmosGuide" class="logo">
        <h1 class="brand-name">CosmosGuide</h1>
        <div style="font-size: 11px; opacity: 0.8; margin-top: 4px;">PRECISION LUNAR TRACKER</div>
    </div>

    <div class="card">
        <div class="location-badge">
            <span id="locStatus">üìç Initializing GPS...</span>
        </div>

        <label>Your Birth Star</label>
        <select id="userStar"></select>

        <label>Today's Live Star üåô</label>
        <div id="starDisplay" class="display-box">Detecting Sky...</div>

        <div class="progress-container">
            <div id="pFill" class="progress-fill"></div>
        </div>
        <div class="progress-label">
            <span id="pPercent">0% Journey</span>
            <span id="pNext">Next Star: --:--</span>
        </div>

        <button class="btn-check" onclick="calculate()">Check Tarabalam</button>

        <div id="resultArea">
            <div id="resIcon" style="font-size: 40px; margin-bottom: 5px;"></div>
            <h3 id="resName" style="margin: 5px 0;"></h3>
            <p id="resDesc" style="font-size: 14px; margin: 0;"></p>
        </div>
    </div>

<script>
    const nakshatras = ["Ashwini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra", "Punarvasu", "Pushya", "Ashlesha", "Magha", "Purva Phalguni", "Uttara Phalguni", "Hasta", "Chitra", "Swati", "Vishakha", "Anuradha", "Jyeshtha", "Mula", "Purva Ashadha", "Uttara Ashadha", "Shravana", "Dhanishta", "Shatabhisha", "Purva Bhadrapada", "Uttara Bhadrapada", "Revati"];
    
    const taraData = {
        1: { name: "Janma Tara", type: "neutral", icon: "‚ö†Ô∏è", desc: "Body focus. Keep routine simple." },
        2: { name: "Sampat Tara", type: "good", icon: "üí∞", desc: "Wealth & Prosperity. Very lucky!" },
        3: { name: "Vipat Tara", type: "bad", icon: "‚õî", desc: "Obstacles. Be cautious with travel." },
        4: { name: "Kshema Tara", type: "good", icon: "üõ°Ô∏è", desc: "Safe & Secure day for well-being." },
        5: { name: "Pratyak Tara", type: "bad", icon: "üöß", desc: "Opposition. Stay patient today." },
        6: { name: "Sadhana Tara", type: "good", icon: "üéØ", desc: "Achievement. Efforts bear fruit." },
        7: { name: "Naidhana Tara", type: "bad", icon: "‚ö†Ô∏è", desc: "Caution. Avoid auspicious tasks." },
        8: { name: "Mitra Tara", type: "good", icon: "üë•", desc: "Friendly day. Socially supportive." },
        0: { name: "Ati-Mitra Tara", type: "good", icon: "‚≠ê", desc: "Best Friend. Highly auspicious!" }
    };

    let liveIndex = null;
    let userLat = 12.9716; // Default Bengaluru
    let userLon = 77.5946;

    const select = document.getElementById('userStar');
    nakshatras.forEach((n, i) => select.options.add(new Option(n, i + 1)));

    function init() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                userLat = pos.coords.latitude;
                userLon = pos.coords.longitude;
                document.getElementById('locStatus').innerText = "üìç GPS Active: Precise Coords";
                updateTracking();
            }, () => {
                document.getElementById('locStatus').innerText = "üìç Default: Bengaluru Sky";
                updateTracking();
            });
        } else {
            updateTracking();
        }
    }

    function updateTracking() {
        const now = new Date();
        const d = now.getTime() / 86400000 - 10957.5;
        
        const L = 218.316 + 13.176396 * d;
        const M = 357.529 + 0.9856003 * d;
        
        let moonLong = L + 6.289 * Math.sin(0.0174533 * (L - M));
        
        // Apply Topocentric Correction based on current coordinates
        const topoCorrection = (userLat / 90) * 0.012; 
        moonLong += topoCorrection;

        const ayanamsha = 23.85 + (d / 36525) * 1.397;
        const siderealLong = (moonLong - ayanamsha + 360) % 360;
        
        const rawIndex = siderealLong / 13.33333;
        liveIndex = Math.floor(rawIndex);
        const progress = (rawIndex - liveIndex) * 100;

        document.getElementById('starDisplay').innerText = nakshatras[liveIndex];
        document.getElementById('pFill').style.width = progress + "%";
        document.getElementById('pPercent').innerText = Math.round(progress) + "% Journey Completed";
        
        const remainingDegrees = 13.33333 - (siderealLong % 13.33333);
        const hoursLeft = remainingDegrees / 0.549; 
        const transitionTime = new Date(now.getTime() + hoursLeft * 3600000);
        document.getElementById('pNext').innerText = "Next Star: " + transitionTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }

    function calculate() {
        const birth = parseInt(select.value);
        let diff = ((liveIndex + 1) - birth + 1);
        while (diff <= 0) diff += 27;
        const tara = taraData[diff % 9];
        const area = document.getElementById('resultArea');
        area.style.display = 'block';
        area.className = tara.type;
        document.getElementById('resIcon').innerText = tara.icon;
        document.getElementById('resName').innerText = tara.name;
        document.getElementById('resDesc').innerText = tara.desc;
    }

    setInterval(updateTracking, 60000);
    window.onload = init;
</script>
</body>
</html>
